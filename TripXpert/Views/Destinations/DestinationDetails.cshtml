
@model TripXpert.Models.DestinationViewModel
@{
    ViewBag.Title = "Destination Details";
    var attractions = string.Join(" ï¿½ ", Model.Attractions.Select(a => a.Title));

    var infoSvg = @"<svg class=""tx-tabstrip-svg"" xmlns=""http://www.w3.org/2000/svg"" viewBox=""0 0 512 512"" focusable=""false""><path d=""M256,0C114.6,0,0,114.6,0,256c0,141.4,114.6,256,256,256s256-114.6,256-256C512,114.6,397.4,0,256,0zM256,469.3c-117.8,0-213.3-95.5-213.3-213.3c0-117.8,95.5-213.3,213.3-213.3S469.3,138.2,469.3,256C469.3,373.8,373.8,469.3,256,469.3z M287.9,128.1c0,17.6-14.3,31.9-31.9,31.9S224,145.7,224,128.1s14.3-31.9,31.9-31.9S287.9,110.4,287.9,128.1z M320,384H192v-13.1c3.1-0.2,11.7-0.5,14.7-0.9c3-0.4,5.6-1,7.7-1.8c3.8-1.4,6.5-3.5,8.1-6.2c1.5-2.7,1.5-5.6,1.5-10.1c0,0,0-125.4,0-128s-6.4-11.5-32-11.2c0,7,0-20.8,0-20.8h93.3l2.7,2.7V352c0,6.7,3.7,12.3,10.3,15.5c6.5,3.1,17,3.3,21.7,3.4V384z"" fill=""currentColor"" fill-rule=""evenodd""></path></svg>";
    var attractionsSvg = @"<svg class=""tx-tabstrip-svg"" xmlns=""http://www.w3.org/2000/svg"" viewBox=""0 0 512 512"" focusable=""false""><path d=""M256,0C114.6,0,0,114.6,0,256c0,141.4,114.6,256,256,256s256-114.6,256-256C512,114.6,397.4,0,256,0zM256,469.3c-117.8,0-213.3-95.5-213.3-213.3c0-117.8,95.5-213.3,213.3-213.3S469.3,138.2,469.3,256C469.3,373.8,373.8,469.3,256,469.3z M128,352 M96,352h320 M96,224v-32 M416,352v32H96v-32 M416,160H96l160-64L416,160z M96,192h320v32H96 M112,352V192h32v160H112 M368,192h32v160h-32V192z M272,352h-32V192h32V352z M336,352h-32V192h32V352z M176,352V192h32v160H176"" fill=""currentColor"" fill-rule=""evenodd""></path></svg>";
    var enquirySvg = @"<svg class=""tx-tabstrip-svg"" xmlns=""http://www.w3.org/2000/svg"" viewBox=""0 0 512 512"" focusable=""false""><path d=""M256,0C114.6,0,0,114.6,0,256c0,141.4,114.6,256,256,256s256-114.6,256-256C512,114.6,397.4,0,256,0zM256,469.3c-117.8,0-213.3-95.5-213.3-213.3c0-117.8,95.5-213.3,213.3-213.3S469.3,138.2,469.3,256C469.3,373.8,373.8,469.3,256,469.3z M96,192l192,192h96v-96L192,96L96,192z M320,288l-32,32L160.3,192.1L192,160L320,288z"" fill=""currentColor"" fill-rule=""evenodd""></path></svg>";
}
@section Kendo
{
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.button.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.listview.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.validator.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.userevents.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.selectable.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.calendar.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.maskedtextbox.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.tabstrip.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.draganddrop.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.window.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.tooltip.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.color.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.drawing.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.dataviz.core.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.fx.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.mobile.scroller.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.dataviz.map.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.mobile.button.min.js"></script>
    <script src="http://kendo.cdn.telerik.com/2018.2.516/js/kendo.mobile.scrollview.min.js"></script>
}
    <div style="height:600px; overflow:visible;">
        <div id="scrollview"></div>

        <a id="prev-img" aria-label="previous" class="k-scrollview-prev">
          <span class="k-icon k-i-arrowhead-w"></span>
        </a>
        <a id="next-img" aria-label="next" class="k-scrollview-next">
            <span class="k-icon k-i-arrowhead-e"></span>
        </a>
    </div>

<div class="pt-4 pb-5" style="position: relative; z-index: 2;">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="mb-4 tx-bottom-dash tx-bottom-dash-start">
                    <h1 class="h1">@Model.Title</h1>
                    <p class="text-muted font-italic">@attractions</p>
                </div>
                <p>
                    Price from $@Model.LowestPrice for <span>@Model.Duration days</span><br />
                    <span id="pricesButton" class="btn-link">view full price info</span>
                </p>
            </div>
            <div class="col-md-4">
                @{ var tourInfos = Model.TourInfos;
                    List<DateTime> list = new List<DateTime>();
                    foreach (var tourInfo in tourInfos)
                    {
                        foreach (var tourDate in tourInfo.TourDates)
                        {
                            list.Add(tourDate);
                        }
                    }
                }
                <div class="k-calendar-container">
                    @(Html.Kendo().Calendar()
                                .Name("toursCalendar")
                                .Selectable("multiple")
                                .SelectDates(list)
                                .Value(Model.TourInfos.First().StartDate)
                                .Footer(false)
                                .HtmlAttributes(new { @class = "tx-calendar-destinations" })
                    )
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bg-white k-flex" style="margin-bottom: -3em; position: relative; z-index: 3">
    <div class="container">
        @(Html.Kendo().TabStrip()
                            .Animation(false)
                            .Scrollable(true)
                            .Name("tabStripInfo")
                            .Items(items =>
                            {
                                items.Add().Text(string.Format("{0} <span class='d-none d-sm-block'>Overview<span>", infoSvg)).Encoded(false).Selected(true)
                                    .Content(@<text>
                                        <div class="row">
                                            <div class="col-md-8">
                                                <p>@Model.FullDescription</p>
                                            </div>
                                            <div class="col-md-4 testimonial">
                                                <blockquote>
                                                    <p>@Model.Testimonial.TestimonialContent</p>
                                                    <footer class="blockquote-footer">@Model.Testimonial.Author.</footer>
                                                </blockquote>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                @(Html.Kendo().Map()
                                                            .Name("overviewMap")
                                                            .Center((double)Model.MapInfo.ZoomSettings["Latitude"], (double)Model.MapInfo.ZoomSettings["Longitude"])
                                                            .Zoom((double)Model.MapInfo.ZoomSettings["Zoom"])
                                                            .HtmlAttributes(new { style = "width: 100%; height: 320px;" })
                                                            .Layers(layers =>
                                                                        {
                                                                                        layers.Add()
                                                            .Type(MapLayerType.Tile)
                                                            .UrlTemplate("https://#= subdomain #.tile.openstreetmap.org/#= zoom #/#= x #/#= y #.png")
                                                            .Subdomains("a", "b", "c")
                                                            .Attribution("&copy; <a href='https://osm.org/copyright' title='OpenStreetMap contributors' target='_blank'>OpenStreetMap contributors</a>");

                                                            }).Markers(markers =>
                                                                {
                                                                    foreach (var marker in Model.MapInfo.Markers)
                                                                    {
                                                                        markers.Add()
                                                                            .Location(marker.LatLng);
                                                                    }
                                                                })
                                                )
                                            </div>  
                                        </div>
                                    </text>);
                                    items.Add().Text(string.Format("{0} <span class='d-none d-sm-block'>Attractions</span>", attractionsSvg)).Encoded(false)
.Content(@<text>
                @(Html.Kendo().ListView(Model.Attractions)
                                    .Name("AttractionsListView")
                                    .TagName("div")
                                    .ClientTemplateId("attractionsTemplate")
                                    .HtmlAttributes(new { @class = "border-0 k-card-columns" })
                )
</text>);
                            items.Add().Text(string.Format("{0} <span class='d-none d-sm-block'>Enquiry Form</span>", enquirySvg)).Encoded(false)
.Content(@<text>
        <form id="enquiry-form">
            <h3>Contact an Expert</h3>
            <p>
                <strong>@Model.Title</strong> has been added to your enquiry.  Please complete the short form. We'll get right back to you to help you with your travels.
            </p>
            <div class="row">
                <div class="form-group col-md-6">
                    <label for="FirstName">First name</label>
                    @(Html.Kendo().TextBox().Name("FirstName").HtmlAttributes(new { @class = "form-control" }))
                </div>
                <div class="form-group col-md-6">
                    <label for="LastName">Last Name</label>
                    @(Html.Kendo().TextBox().Name("LastName").HtmlAttributes(new { @class = "form-control" }))
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-6">
                    <label for="Email">Email</label>
                    @(Html.Kendo().TextBox().Name("Email").HtmlAttributes(new { @class = "form-control" }))
                </div>
                <div class="form-group col-md-6">
                    <label>Mobile</label>
                    @(Html.Kendo().MaskedTextBox()
                                        .Name("mobile")
                                        .Mask("(999) 000-0000")
                                        .HtmlAttributes(new { @style = "width: 100%" })
                    )
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-12">
                    <label for="Comments">Comments</label>
                    @(Html.TextArea("Comments", new { style = "width: 100%; resize: none;", rows = "5", @class = "form-control", cols = "200" }))
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    @(Html.Kendo().Button()
                                .Name("sendEnquiry")
                                .Content("Send")
                                .Events(e => e.Click("enquirySendClick"))
                                .HtmlAttributes(new { @class = "k-primary" })
                    )
                </div>
            </div>
        </form>
</text>);
                        })
        .HtmlAttributes(new { @class = "tx-tabstrip-destinations" })
        )
    </div>
</div>

@(Html.Kendo().Window()
                .Name("windowPriceInfo")
                .Title("Full Price Info")
                .Visible(false)
                .Content(@<text>
                    <script type="text/x-kendo-tmpl" id="priceInfoTemplate">
                        <p>Tour Rates: #: kendo.toString(data.StartDate, "dd MMMM yyyy")# - #: kendo.toString(data.EndDate, "dd MMMM yyyy")#</p>
                        <ul>
                            <li>$#:data.PerPersonSharing#  per person sharing</li>
                            <li>$#:data.PerSingleOccupancy# per single occupancy</li>
                            <li>$#:data.PerChild# per child (14 - 16 years)</li>
                        </ul>
                    </script>
                    @(Html.Kendo().ListView(Model.TourInfos)
                                    .Name("listView")
                                    .TagName("div")
                                    .ClientTemplateId("priceInfoTemplate")
                    )
                </text>)
                .Actions(actions => actions.Close())
)
@(Html.Kendo().Window()
                .Name("largeMapWindow")
                .Title("Itinerary map")
                .Visible(false)
                .Content(@<text>
                    @(Html.Kendo().Map()
                                .Name("largeMap")
                                .Center((double)Model.MapInfo.ZoomSettings["Latitude"], (double)Model.MapInfo.ZoomSettings["Longitude"])
                                .HtmlAttributes(new { style = "height:660px; width: 820px;" })
                                .Layers(layers =>
                                {
                                        layers.Add()
                                        .Type(MapLayerType.Tile)
                                        .UrlTemplate("https://#= subdomain #.tile.openstreetmap.org/#= zoom #/#= x #/#= y #.png")
                                        .Subdomains("a", "b", "c")
                                        .Attribution("&copy; <a href='https://osm.org/copyright' title='OpenStreetMap contributors' target='_blank'>OpenStreetMap contributors</a>");
                                    })
                                .Markers(markers =>
                                {
                                        foreach (var marker in Model.MapInfo.Markers)
                                        {
                                            markers.Add()
                                                .Location(marker.LatLng);
                                        }
                                })
                    )
                </text>)
                        .Actions(actions => actions.Close())
)

<script id="template" type="text/x-kendo-template">
    <div class="jumbotron jumbotron-fluid m-0 jumbotron-splash" style="background-image: url('/Images/Gallery/#:FolderName.trim()#/#:ImageURL#');" title="#:Title#"></div>
</script>

<script>
    $("#pricesButton").on("click", function (e) {
        $("#windowPriceInfo").data("kendoWindow").center().open();
    });

    var validator = $("#enquiry-form").kendoValidator().getKendoValidator();

    function enquirySendClick(e) {
        e.preventDefault();
        if (validator.validate()) {
            kendo.alert("Thank you for sending an inquiry! We will be in touch shortly.");
        }
    }

    var scrollViewDs = new kendo.data.DataSource({
        transport: {
            read: '/Destinations/GetDestinationImages?destinationId=@Model.DestinationID'
        }
    })

    $(document).ready(function () {

        $("#scrollview").kendoMobileScrollView({
            dataSource: scrollViewDs,
            contentHeight:"600px",
            template: kendo.template($("#template").html())
        });
        
        var smallMap = $("#overviewMap").data("kendoMap");
        var largeMap = $("#largeMap").data("kendoMap");

        $("#prev-img").click(function (e) {
            var scrollView = $("#scrollview").data("kendoMobileScrollView");
            scrollView.prev();
        });

        $("#next-img").click(function (e) {
            var scrollView = $("#scrollview").data("kendoMobileScrollView");
            scrollView.next();
        });

        largeMap.setOptions({
            zoom: smallMap.zoom() + 1
        });
    });

    function toggleDescription(e) {
        $(e.target).parents('.k-card').find('.k-card-text').slideToggle();
        $(e.target).toggle();
        $(e.target).siblings('.k-icon').toggle();
    }
</script>
<script id="attractionsTemplate" type="text/x-kendo-tmpl">
    <div id="attractions-template">
        <div class="k-card">
            <img class="k-card-image" src="#=Image.ImageURL#" alt="#=Title#">
            <div class="k-card-body">
                <h5 class="k-card-title">#:Title#
                <span onclick="toggleDescription(event)" class="k-icon k-i-arrow-chevron-down"></span>
                <span onclick="toggleDescription(event)" class="k-icon k-i-arrow-chevron-up"></span>

                </h5>
                <p class="k-card-subtitle small text-muted font-italic">#:Location#</p>
                <p class="k-card-text">#: Description #</p>
            </div>
        </div>
    </div>
</script>

<style>
    .k-scrollview-next, .k-scrollview-prev {
        display: table;
        position: absolute;
        padding: 0;
        height: 40%;
        top: 10%;
    }

        .k-scrollview-next span, .k-scrollview-prev span {
            display: table-cell;
            margin: 0;
            padding: 0;
            vertical-align: middle;
            font-size: 4.5em;
            font-weight: 400;
        }

        .k-scrollview-next:hover, .k-scrollview-prev:hover {
            opacity: 0.6;
        }

    #attractions-template .k-icon {
        float: right;
        font-size: 2rem;
        cursor: pointer;
    }

    #attractions-template .k-card-text {
        display: none;
    }

    #attractions-template .k-i-arrow-chevron-up {
        display: none;
    }

</style>